# ontology-editor

## Dev Setup

### A. GitHub Setup

1. Create an OAuth app: https://github.com/settings/applications/new
1. Homepage / Callback : `http://localhost:3000/`
1. Fill the env vars in `.env`:
    ```
    OAUTH_CLIENT_ID=6bac5524e0e11f1ae9ec
    OAUTH_CLIENT_SECRET=b5d15ea361b1d28a44152599c72621a36c631751
    ```

### B. Local Setup

1. `npm install`
1. Run the project:
  * Database and GraphQL API:
      * `make up`
  * Front dev server + watch:
    1. Export all environment variables from `./docker-app-dev/.env`
        * If you only want to watch the front (you probably do): `npm run dev`
        * If you want to watch the front AND the API: `npm run dev-api`

Whenever you feel like it:

* Deleting the DB to start over:
    * `make reset`

## Architecture

### 3 Services

1. A Postgres Database
1. A GraphQL API backed by Postgres, generated by introspecting the pg schema.
1. A web backend made of:
    * A Nuxt app, using Apollo as GraphQL client.
    * A Nuxt Server Middleware implemented as an Express API
        * This is where the forge-specific functionality (GitHub, GitLab, â€¦) is implemented
        * Configurable via `nuxt.config.js`

### Concepts and Implementation Overview

#### Threads

* A thread is a conversation, messages belong to a thread.
* A thread has a type, at the moment a thread can either be a `discussion` or a `proposal`.

#### PR

* A PR is a Pull Request or Merge Request.
* A PR is created by a system account hitting the Forge API.
* Creating a PR is roughly:
    1. Create a branch based on `master`, give it a unique name.
    1. Apply the proposed changes to the files on this branch.
    1. Create a commit attributed to the original author, push the branch to the origin.
    1. Open a PR targeting `master`, retrieve the PR `id`, store it as `thread.external_id`.

### To Consider

* ~~Should the forge-specific functionalities be implemented as a GraphQL endpoint?~~
  * How does Apollo support multiple endpoints?
    * GitHub GraphQL API is not complete enough anyway.
  * https://www.prisma.io/blog/how-to-wrap-a-rest-api-with-graphql-8bf3fb17547d/
  * https://medium.com/@sastraxi/authenticated-and-stitched-schemas-with-postgraphile-passport-and-stripe-a51490a858a2
  * https://www.apollographql.com/docs/graphql-tools/schema-stitching.html

### Helpful Tools

- Vue devtools extension [Chrome, Firefox](https://github.com/vuejs/vue-devtools#installation)
- Local GraphQL IDE: [Graph*i*QL `http://localhost:5000/graphiql`](http://localhost:5000/graphiql)
- A postgres client (e.g. [Postico](https://eggerapps.at/postico/) for MacOS) to inspect schemas and data
- Apollo devtools extension [Chrome, Firefox](https://github.com/apollographql/apollo-client-devtools#apollo-client-devtools)

## References

* GraphQL: https://graphql.org/learn/
* Postgraphile: https://www.graphile.org/postgraphile/introduction/
* Nuxt: https://nuxtjs.org/guide/installation
    * Apollo: https://github.com/nuxt-community/apollo-module
    * Auth: https://auth.nuxtjs.org/
